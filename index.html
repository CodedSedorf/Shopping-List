<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css">
</head>
<style>
    *{
        margin: 0;
        padding: 0;
    }
    body{
        background-color: #AFDBF5;
    }
    .container{
        margin-top: 50px;
    }
    .sedorf{
        font-size: 10px;
        font-weight: 500;
        font-family: fantasy;
    }
</style>

<body>
    <div class="container mx-auto row">
        <div class="col-sm-8 shadow-lg mx-auto py-4">
            <h6 class="display-6 text-muted text-center py-2">Shopping List</h6>
            <center>
                <p class="sedorf">Dev Sedorf</p>
            </center>
            <input class="form-control my-3" placeholder="Shopping Item" type="text" id="input1">
            <input class="form-control my-3" placeholder="Price" type="number" id="input2">
            <input class="form-control my-3" placeholder="Quantity" type="number" id="input3">
            <div class="d-flex justify-content-between">
                <button class="btn btn-dark my-3" onclick="addToShoppingList()">Submit</button>
                <div id="totalDiv"></div>
            </div>
        </div>

        <div id="displayDiv">

        </div>
    </div>
</body>
<script>
    let input1 = document.getElementById("input1")
    let input2 = document.getElementById("input2")
    let input3 = document.getElementById("input3")
    let displayDiv = document.getElementById("displayDiv")
    let arr1 = []
    let totalDiv = document.getElementById("totalDiv")

    //This adds an empty array with the key "shoppingList" to localStorage if it doesn't exist
    if (localStorage.getItem("shoppingList") === null) {
        localStorage.setItem("shoppingList", JSON.stringify(arr1))
    }


    //To display to the DOM on reload of the page
    let displayArr = localStorage.getItem("shoppingList")
    displayArr = JSON.parse(displayArr)
    displayArr.map((i, index) => {
        console.log(i, index)
        displayDiv.innerHTML += `
            <div class="card my-2 py-3 d-flex flex-row justify-content-evenly">
                <p>Item: ${i.item}</p>
                <p>Price: ${i.price}</p>
                <p>Quantity: ${i.quantity}</p>
                <p>Sub-total: ${i.quantity * i.price}</p>
                <button class="btn btn-dark" onclick="deleteItem(${index})">Delete</button>
                <button class="btn btn-dark" onclick="editItem(${index})">Edit</button>
            </div>
            `
    })

    totalDiv.innerHTML = displayArr.reduce((accumulator, i)=>{
        return accumulator + (i.quantity * i.price)
    }, 0)

    //To add item to the shopping list
    const addToShoppingList = () => {
        //We add the values in the inputs to an object
        const item = {
            item: input1.value,
            price: Number(input2.value),
            quantity: Number(input3.value)
        }

        //We grab our array from localStorage and add its content (and the new object) to a new array
        let oldArr = localStorage.getItem("shoppingList")
        let oldArr2 = JSON.parse(oldArr)
        console.log(oldArr2)
        // arr1 = [...oldArr2, item]
        // console.log(arr1)
        // localStorage.setItem("shoppingList", JSON.stringify(arr1))\
        //or
        oldArr2.push(item)
        localStorage.setItem("shoppingList", JSON.stringify(oldArr2))



        //We are re-rendering our dom on creating a new item in our array
        window.location.href = "shoppingList2.html"
    }

    const deleteItem = (index) => {
        const newArr = localStorage.getItem("shoppingList")
        const newArr2 = JSON.parse(newArr)
        console.log(newArr2)
        newArr2.splice(index, 1)
        console.log(newArr2)
        localStorage.setItem("shoppingList", JSON.stringify(newArr2))
        window.location.href = "shoppingList2.html"
    }

    const editItem = (index) => {
        const newArr = localStorage.getItem("shoppingList")
        const newArr2 = JSON.parse(newArr)
        let test1 = prompt("Enter new item", newArr2[index].item)
        let test2 = prompt("Enter new price", newArr2[index].price)
        let test3 = prompt("Enter new quantity", newArr2[index].quantity)
        let newItem = {
            item: test1,
            price: test2,
            quantity: test3
        }
        newArr2.splice(index, 1, newItem)
        console.log(newArr2)
        localStorage.setItem("shoppingList", JSON.stringify(newArr2))
        window.location.href = "shoppingList2.html"
    }
</script>

</html>